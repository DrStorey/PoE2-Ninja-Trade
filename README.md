Как установить скрипт «PoE2 Ninja → Trade»

Этот гайд покажет, как поставить Tampermonkey-скрипт, который добавляет на poe.ninja кнопку Trade прямо на ячейку предмета и открывает PoE2 Trade с уже подставленными модами.

1) Поставьте Tampermonkey

Tampermonkey — это менеджер пользовательских скриптов (работает в большинстве браузеров).

Chrome / Brave / Edge: откройте Chrome Web Store → найдите Tampermonkey → Установить.
Магазин расширение Chrome: https://chromewebstore.google.com/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo

Firefox: откройте addons.mozilla.org, найдите Tampermonkey, установите.
Магазин расширений Firefox: https://addons.mozilla.org/ru/firefox/addon/tampermonkey/

Opera: сначала “Install Chrome Extensions” (если нужно), затем — Tampermonkey из Web Store.
Магазин расширений Opera: https://addons.opera.com/en/extensions/details/tampermonkey-beta/

После установки у вас появится значок Tampermonkey (чёрная иконка с двумя точками) справа в панели браузера.

2) Создайте новый скрипт

Нажмите по значку Tampermonkey → Dashboard (Панель).

Вверху нажмите ➕ Create a new script… (Создать новый скрипт).

Откроется редактор с шаблоном — удалите всё, что там есть.

3} Скачайте скрипт в разделе realeses

ссылка: https://github.com/DrStorey/PoE2-Ninja-Trade/releases

Откройте файл любым редактором файлов, рекомендуется Notepad++

4) Вставьте код скрипта

Скопируйте целиком код скрипта, который мы в чате прислали последним (версия с API stats, POST+retry, value:null).

Вставьте его в окно Tampermonkey.

Нажмите File → Save (или Ctrl+S).

Убедитесь, что в правом верхнем углу скрипт имеет статус Enabled (включён).

Если позже выйдет новая версия — просто откройте скрипт в Tampermonkey, замените код и Save.

5) Дайте разрешение на запросы к pathofexile.com

При первом клике на кнопке Trade Tampermonkey может спросить доступ (permissions) для сайта:

pathofexile.com (нужно, чтобы скрипт создавал поиск на Trade через API).

Нажмите Разрешить / Allow. Без этого скрипт не сможет создать поиск и открыть нужную страницу.

6) Проверьте работу

Откройте любую страницу персонажа PoE2 на poe.ninja, например:
https://poe.ninja/poe2/builds/abyss/character/<account>/<charname>
(важно: именно страница character, где видны предметы).

Наведите мышку на ячейку предмета – на самой плитке появится маленькая кнопка Trade.

Кликните Trade:

откроется новая вкладка Path of Exile Trade (PoE2);

скрипт “создаст” поиск через API и откроет страницу с ID (адрес вида: /trade2/search/poe2/<league>/<id>).

Если всё ок — в трейде вы увидите заполненные Stat Filters (по модам с предмета).

7) Как смотреть лог модов (необязательно, но полезно если у вас что-то не работает и надо показать мне)

Нажмите F12 (Открыть DevTools) → вкладка Console.

Кликните кнопку Trade ещё раз.

В консоли появится свёрнутая группа вида
[PoE2→Trade] Weapon | <имя> — <база> (mods: X, matched: Y)

Разверните — увидите таблицу всех модов:

raw — как мод выглядит на предмете,

template — нормализованный шаблон,

ids / chosenId — какие stat id нашли и какой выбран,

value — всегда null,

note — результат сопоставления.

Это помогает понять, почему какой-то конкретный мод мог не попасть (редко бывает из-за формулировок).

8) Частые вопросы и проблемы

Кнопка есть, но при клике ничего не происходит
– Дождитесь 1–2 сек после загрузки страницы персонажа: скрипт должен “подхватить” данные из API poe.ninja.
– Если просит доступ к pathofexile.com — разрешите.
– Если включено много других userscript’ов, временно выключите их и проверьте конфликт.

Появляется красная ошибка “Failed to load search state”
– В данной версии скрипта запрос создаётся через POST и открывается по ID — эта ошибка не должна появляться.
– Если вдруг видите её, откройте консоль: возможно, сервер вернул Unknown item name. Скрипт уже делает ретрай без name (для редких/магических предметов), так что ошибка должна уйти. Если повторяется — напишите, на каком предмете.

В трейде пусто / не все моды подхватились
– В консоли посмотрите таблицу: какие моды имеют note: "NOT MATCHED".
– Пришлите эти строки — я расширю “словарь синонимов” (проблемные места бывают у формулировок крит. шанса/мультипликатора, некоторых новых аффиксов и т.п.).

Как выключить или удалить
– Откройте Tampermonkey → Dashboard → найдите скрипт → переключите тумблер Enabled (выкл) или нажмите Delete.

9) Важно переодически вы можете видить что после перехода на trade вы item non found.
Такое бывает, посмотрите что у вас в модификаторах в поиске, отключите local моды, или в строке поиска уберите названия предмета.
Если нашли ошибки или не получается что-то Пишите в комьюнити https://t.me/Arpg_community с тегом @TheStorey
